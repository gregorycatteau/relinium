name: üìö V√©rification documentation

on:
  pull_request:
    branches: [ "main" ]
  push:
    branches: [ "main" ]

jobs:
  check-docs:
    name: üîç V√©rification docs essentielles
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4
        
      - name: ‚úÖ V√©rification fichiers requis
        run: |
          echo "üîç V√©rification des fichiers de base..."
          
          # Liste des fichiers obligatoires
          REQUIRED_FILES=(
            "README.md"
            "SECURITY.md"
            "GOVERNANCE.md"
            "CODE_OF_CONDUCT.md"
            "CONTRIBUTING.md"
            "LICENSE"
            ".gitignore"
            ".github/CODEOWNERS"
            ".github/PULL_REQUEST_TEMPLATE.md"
          )
          
          MISSING_FILES=()
          
          for file in "${REQUIRED_FILES[@]}"; do
            if [ ! -f "$file" ]; then
              echo "‚ùå Fichier manquant : $file"
              MISSING_FILES+=("$file")
            else
              echo "‚úÖ $file"
            fi
          done
          
          if [ ${#MISSING_FILES[@]} -ne 0 ]; then
            echo ""
            echo "‚ùå Fichiers manquants : ${MISSING_FILES[*]}"
            exit 1
          fi
          
          echo ""
          echo "‚úÖ Tous les fichiers essentiels sont pr√©sents"
          
      - name: üìÇ V√©rification structure docs/
        run: |
          echo "üîç V√©rification de la structure docs/..."
          
          # V√©rifier que le dossier docs existe
          if [ ! -d "docs" ]; then
            echo "‚ùå Le dossier docs/ est manquant"
            exit 1
          fi
          
          # Liste des sous-dossiers requis
          REQUIRED_DIRS=(
            "docs/00-overview"
            "docs/01-genesis"
            "docs/02-strategy"
            "docs/03-architecture/decisions"
            "docs/03-architecture/rfcs"
            "docs/04-risk"
            "docs/05-governance"
            "docs/06-ops"
            "docs/07-contrib"
          )
          
          MISSING_DIRS=()
          
          for dir in "${REQUIRED_DIRS[@]}"; do
            if [ ! -d "$dir" ]; then
              echo "‚ö†Ô∏è  Dossier manquant : $dir"
              MISSING_DIRS+=("$dir")
            else
              echo "‚úÖ $dir"
            fi
          done
          
          if [ ${#MISSING_DIRS[@]} -ne 0 ]; then
            echo ""
            echo "‚ö†Ô∏è  Dossiers manquants : ${MISSING_DIRS[*]}"
            echo "‚ÑπÔ∏è  Note : Certains dossiers seront cr√©√©s au fur et √† mesure"
          fi
          
          echo ""
          echo "‚úÖ Structure documentaire v√©rifi√©e"
          
      - name: üîê V√©rification s√©curit√© basique
        run: |
          echo "üîç V√©rification de s√©curit√© basique..."
          
          # V√©rifier qu'il n'y a pas de secrets √©vidents
          if grep -r -i "password\s*=\s*['\"]" . --exclude-dir={.git,node_modules,dist} --exclude="*.md"; then
            echo "‚ùå Possible mot de passe en clair d√©tect√©"
            exit 1
          fi
          
          if grep -r -i "api[_-]?key\s*=\s*['\"]" . --exclude-dir={.git,node_modules,dist} --exclude="*.md"; then
            echo "‚ùå Possible cl√© API en clair d√©tect√©e"
            exit 1
          fi
          
          if grep -r -i "secret\s*=\s*['\"]" . --exclude-dir={.git,node_modules,dist} --exclude="*.md"; then
            echo "‚ùå Possible secret en clair d√©tect√©"
            exit 1
          fi
          
          echo "‚úÖ Aucun secret √©vident d√©tect√©"
          
      - name: üìä R√©sum√©
        if: success()
        run: |
          echo ""
          echo "================================================"
          echo "‚úÖ Toutes les v√©rifications sont pass√©es !"
          echo "================================================"
          echo ""
          echo "üìö Documentation : OK"
          echo "üìÇ Structure : OK"
          echo "üîê S√©curit√© basique : OK"
          echo ""
